var marketplace=(()=>{var e,q=Object.create,n=Object.defineProperty,M=Object.defineProperties,$=Object.getOwnPropertyDescriptor,U=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,F=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,G=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,d=(e,t)=>{for(var a in t=t||{})K.call(t,a)&&G(e,a,t[a]);if(s)for(var a of s(t))D.call(t,a)&&G(e,a,t[a]);return e},h=(e,t)=>M(e,U(t)),a=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)(function(e){if("react"===e)return Spicetify.React;if("react-dom"===e)return Spicetify.ReactDOM;if("undefined"!=typeof require)return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),t=(e,t)=>function(){return t||(0,e[l(e)[0]])((t={exports:{}}).exports,t),t.exports},B=(t,a,s,r)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let e of l(a))K.call(t,e)||e===s||n(t,e,{get:()=>a[e],enumerable:!(r=$(a,e))||r.enumerable});return t},r=(e,t,a)=>(a=null!=e?q(F(e)):{},B(!t&&e&&e.__esModule?a:n(a,"default",{value:e,enumerable:!0}),e)),J=t({"node_modules/classnames/index.js"(e,t){!function(){"use strict";var l={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var a=arguments[t];if(a){var s,r=typeof a;if("string"==r||"number"==r)e.push(a);else if(Array.isArray(a))!a.length||(s=i.apply(null,a))&&e.push(s);else if("object"==r)if(a.toString===Object.prototype.toString)for(var n in a)l.call(a,n)&&a[n]&&e.push(n);else e.push(a.toString())}}return e.join(" ")}void 0!==t&&t.exports?t.exports=i.default=i:"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return i}):window.classNames=i}()}}),t=t({"node_modules/react-dropdown/dist/index.js"(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var p=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var t=l();if(t&&t.has(e))return t.get(e);var a,s={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(a in e){var n;Object.prototype.hasOwnProperty.call(e,a)&&((n=r?Object.getOwnPropertyDescriptor(e,a):null)&&(n.get||n.set)?Object.defineProperty(s,a,n):s[a]=e[a])}s.default=e,t&&t.set(e,s);return s}(a("react")),m=(t=J())&&t.__esModule?t:{default:t};function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,s=arguments[t];for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function c(t,e){var a,s=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)),s}function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f="Select...",t=function(e){var t,a=s;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function s(e){var t,a;if(this instanceof s)return t=this,(t=!(a=n(s).call(this,e))||"object"!==i(a)&&"function"!=typeof a?u(t):a).state={selected:t.parseValue(e.value,e.options)||{label:void 0===e.placeholder?f:e.placeholder,value:""},isOpen:!1},t.dropdownRef=(0,p.createRef)(),t.mounted=!0,t.handleDocumentClick=t.handleDocumentClick.bind(u(t)),t.fireChangeEvent=t.fireChangeEvent.bind(u(t)),t;throw new TypeError("Cannot call a class as a function")}return a.prototype=Object.create(e&&e.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),e&&h(a,e),a=s,(e=[{key:"componentDidUpdate",value:function(e){this.props.value!==e.value&&(this.props.value?(e=this.parseValue(this.props.value,this.props.options))!==this.state.selected&&this.setState({selected:e}):this.setState({selected:{label:void 0===this.props.placeholder?f:this.props.placeholder,value:""}}))}},{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleDocumentClick,!1),document.addEventListener("touchend",this.handleDocumentClick,!1)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,document.removeEventListener("click",this.handleDocumentClick,!1),document.removeEventListener("touchend",this.handleDocumentClick,!1)}},{key:"handleMouseDown",value:function(e){this.props.onFocus&&"function"==typeof this.props.onFocus&&this.props.onFocus(this.state.isOpen),"mousedown"===e.type&&0!==e.button||(e.stopPropagation(),e.preventDefault(),this.props.disabled||this.setState({isOpen:!this.state.isOpen}))}},{key:"parseValue",value:function(t,e){var a;if("string"==typeof t)for(var s,r=0,n=e.length;r<n;r++)"group"===e[r].type?(s=e[r].items.filter(function(e){return e.value===t})).length&&(a=s[0]):void 0!==e[r].value&&e[r].value===t&&(a=e[r]);return a||t}},{key:"setValue",value:function(e,t){e={selected:{value:e,label:t},isOpen:!1};this.fireChangeEvent(e),this.setState(e)}},{key:"fireChangeEvent",value:function(e){e.selected!==this.state.selected&&this.props.onChange&&this.props.onChange(e.selected)}},{key:"renderOption",value:function(a){var e=a.value,t=(void 0===e&&(e=a.label||a),a.label||a.value||a),s=e===this.state.selected.value||e===this.state.selected;d(r={},"".concat(this.props.baseClassName,"-option"),!0),d(r,a.className,!!a.className),d(r,"is-selected",s);var r=(0,m.default)(r),n=Object.keys(a.data||{}).reduce(function(e,t){return function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?c(a,!0).forEach(function(e){d(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):c(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}({},e,d({},"data-".concat(t),a.data[t]))},{});return p.default.createElement("div",o({key:e,className:r,onMouseDown:this.setValue.bind(this,e,t),onClick:this.setValue.bind(this,e,t),role:"option","aria-selected":s?"true":"false"},n),t)}},{key:"buildMenu",value:function(){var s=this,e=this.props,t=e.options,r=e.baseClassName,e=t.map(function(e){var t,a;return"group"===e.type?(t=p.default.createElement("div",{className:"".concat(r,"-title")},e.name),a=e.items.map(function(e){return s.renderOption(e)}),p.default.createElement("div",{className:"".concat(r,"-group"),key:e.name,role:"listbox",tabIndex:"-1"},t,a)):s.renderOption(e)});return e.length?e:p.default.createElement("div",{className:"".concat(r,"-noresults")},"No options found")}},{key:"handleDocumentClick",value:function(e){!this.mounted||this.dropdownRef.current.contains(e.target)||this.state.isOpen&&this.setState({isOpen:!1})}},{key:"isValueSelected",value:function(){return"string"==typeof this.state.selected||""!==this.state.selected.value}},{key:"render",value:function(){var e=this.props,t=e.baseClassName,a=e.controlClassName,s=e.placeholderClassName,r=e.menuClassName,n=e.arrowClassName,l=e.arrowClosed,i=e.arrowOpen,e=e.className,o=this.props.disabled?"Dropdown-disabled":"",c="string"==typeof this.state.selected?this.state.selected:this.state.selected.label,e=(0,m.default)((d(u={},"".concat(t,"-root"),!0),d(u,e,!!e),d(u,"is-open",this.state.isOpen),u)),a=(0,m.default)((d(u={},"".concat(t,"-control"),!0),d(u,a,!!a),d(u,o,!!o),u)),u=(0,m.default)((d(o={},"".concat(t,"-placeholder"),!0),d(o,s,!!s),d(o,"is-selected",this.isValueSelected()),o)),o=(0,m.default)((d(s={},"".concat(t,"-menu"),!0),d(s,r,!!r),s)),s=(0,m.default)((d(r={},"".concat(t,"-arrow"),!0),d(r,n,!!n),r)),n=p.default.createElement("div",{className:u},c),r=this.state.isOpen?p.default.createElement("div",{className:o,"aria-expanded":"true"},this.buildMenu()):null;return p.default.createElement("div",{ref:this.dropdownRef,className:e},p.default.createElement("div",{className:a,onMouseDown:this.handleMouseDown.bind(this),onTouchEnd:this.handleMouseDown.bind(this),"aria-haspopup":"listbox"},n,p.default.createElement("div",{className:"".concat(t,"-arrow-wrapper")},i&&l?this.state.isOpen?i:l:p.default.createElement("span",{className:s}))),r)}}])&&r(a.prototype,e),t&&r(a,t),s}(p.Component);t.defaultProps={baseClassName:"Dropdown"},e.default=t}}),H={},V=H,W={default:()=>function(){return Fe.default.createElement(Ue,null)}};for(e in W)n(V,e,{get:W[e],enumerable:!0});var i=r(a("react")),o=r(a("react")),f=(t,e)=>{t=localStorage.getItem(t);if(!t)return e;try{return JSON.parse(t)}catch(e){return t}},c=e=>{const t=document.querySelector("style.marketplaceSnippets"),a=(t&&t.remove(),document.createElement("style"));e=e.reduce((e,t)=>e=(e+=`/* ${t.title} - ${t.description} */
`)+t.code+`
`,"");a.innerHTML=e,a.classList.add("marketplaceSnippets"),document.head.appendChild(a)},z=(e,t)=>{let a=[];return e&&0<e.length?a=e:a.push({name:t,url:"https://github.com/"+t}),a},Q=()=>{console.log("Resetting Marketplace"),Object.keys(localStorage).forEach(e=>{e.startsWith("marketplace:")&&(localStorage.removeItem(e),console.log("Removed "+e))}),console.log("Marketplace has been reset"),location.reload()},Y=a=>{const e=document.querySelector("link[href='colors.css']"),t=(e&&e.remove(),document.querySelector("style.marketplaceCSS.marketplaceScheme"));if(t&&t.remove(),a){const s=document.createElement("style");s.classList.add("marketplaceCSS"),s.classList.add("marketplaceScheme");let t=":root {";const r=Object.keys(a);r.forEach(e=>{t=(t+=`--spice-${e}: #${a[e]};`)+`--spice-rgb-${e}: ${(e=>{if(3===e.length)e=e.split("").map(e=>e+e).join("");else{if(6!=e.length)throw"Only 3- or 6-digit hex colours are allowed.";if(e.match(/[^0-9a-f]/i))throw"Only hex colours are allowed."}e=e.match(/.{1,2}/g);if(e&&3===e.length)return[parseInt(e[0],16),parseInt(e[1],16),parseInt(e[2],16)];throw"Could not parse hex colour."})(a[e])};`}),t+="}",s.innerHTML=t,document.head.appendChild(s)}else{const n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href","colors.css"),n.classList.add("userCSS"),document.head.appendChild(n)}};var g="marketplace:installed-extensions",y="marketplace:installed-snippets",v="marketplace:installed-themes",Z="marketplace:active-tab",u="marketplace:tabs",X="marketplace:sort-by",p="marketplace:theme-installed",ee=[{name:"Extensions",enabled:!0},{name:"Themes",enabled:!0},{name:"Snippets",enabled:!0},{name:"Installed",enabled:!0}],b=100,te="/marketplace",m=r(a("react")),S=r(a("react")),ae=r(a("react")),se="button-module__button___hf2qg_marketplace",re="button-module__circle___EZ88P_marketplace",C=e=>{var t=e.type||"round";const a=[se];return"circle"===t&&a.push(re),e.classes&&a.push(...e.classes),ae.default.createElement("button",{className:a.join(" "),onClick:e.onClick,"aria-label":e.label},e.children)},ne=()=>{const[n,t]=S.default.useState(""),[l,a]=S.default.useState(""),[i,s]=S.default.useState("");return S.default.createElement("div",{id:"marketplace-add-snippet-container"},S.default.createElement("div",{className:"marketplace-customCSS-input-container"},S.default.createElement("label",{htmlFor:"marketplace-custom-css"},"Custom CSS"),S.default.createElement("textarea",{id:"marketplace-custom-css",rows:4,cols:50,value:n,onChange:e=>t(e.target.value),placeholder:"Input your own custom CSS here! You can find them in the installed tab for management."})),S.default.createElement("div",{className:"marketplace-customCSS-input-container"},S.default.createElement("label",{htmlFor:"marketplace-customCSS-name-submit"},"Snippet Name"),S.default.createElement("input",{id:"marketplace-customCSS-name-submit",value:l,onChange:e=>a(e.target.value),placeholder:"Enter a name for your custom snippet."})),S.default.createElement("div",{className:"marketplace-customCSS-input-container"},S.default.createElement("label",{htmlFor:"marketplace-customCSS-description-submit"},"Snippet Description"),S.default.createElement("input",{id:"marketplace-customCSS-description-submit",value:i,onChange:e=>s(e.target.value),placeholder:"Enter a description for your custom snippet."})),S.default.createElement(C,{onClick:()=>{var e=n.replace(/\n/g,""),t=l.replace(/\n/g,""),a=i.trim(),s="marketplace:installed:snippet:"+t;if(f(s))alert("That name is already taken!");else{console.log("Installing snippet: "+t),localStorage.setItem(s,JSON.stringify({code:e,description:a,title:t}));const r=f(y,[]);-1===r.indexOf(s)&&(r.push(s),localStorage.setItem(y,JSON.stringify(r)));e=r.map(e=>f(e));c(e),Spicetify.PopupModal.hide()}}},"Save CSS"))},k=r(a("react")),le=()=>k.default.createElement("div",{id:"marketplace-reload-container"},k.default.createElement("p",null,"A page reload is required to complete this operation."),k.default.createElement("div",{className:"marketplace-reload-modal__button-container"},k.default.createElement(C,{onClick:()=>{Spicetify.PopupModal.hide(),location.reload()}},"Reload now"),k.default.createElement(C,{onClick:()=>{Spicetify.PopupModal.hide()}},"Reload later"))),E=r(a("react")),w=r(a("react")),N=r(a("react")),ie="toggle-module__toggle-wrapper___ocE5z_marketplace",oe="toggle-module__disabled___OYAYf_marketplace",ce="toggle-module__toggle-input___ceLM4_marketplace",ue="toggle-module__toggle-indicator-wrapper___6Lcp0_marketplace",pe="toggle-module__toggle-indicator___nCxwE_marketplace",me=e=>{var t="toggle:"+e.storageKey;const a=[ie];return!1===e.clickable&&a.push(oe),N.default.createElement("label",{className:a.join(" ")},N.default.createElement("input",{className:ce,type:"checkbox",checked:e.enabled,"data-storage-key":e.storageKey,id:t,title:"Toggle for "+e.storageKey,onChange:e.onChange}),N.default.createElement("span",{className:ue},N.default.createElement("span",{className:pe})))},O=a=>{var e="toggle:"+a.storageKey,t=!!a.modalConfig.visual[a.storageKey];return w.default.createElement("div",{className:"setting-row"},w.default.createElement("label",{htmlFor:e,className:"col description"},a.name),w.default.createElement("div",{className:"col action"},w.default.createElement(me,{name:a.name,storageKey:a.storageKey,enabled:t,onChange:e=>{var t=e.target.checked,e=e.target.dataset.storageKey;a.modalConfig.visual[e]=t,console.log(`toggling ${e} to `+t),localStorage.setItem("marketplace:"+e,String(t)),a.updateConfig(a.modalConfig)}})))},I=r(a("react")),de=s=>{var e="toggle:"+s.name;const t=s.modalConfig.tabs.reduce((e,t,a)=>t.name===s.name?a:e,-1);var a=s.modalConfig.tabs[t]["enabled"];function r(e,t){console.log({currPos:e,dir:t});var t=e+t,a=s.modalConfig.tabs[t];s.modalConfig.tabs[t]=s.modalConfig.tabs[e],s.modalConfig.tabs[e]=a,localStorage.setItem(u,JSON.stringify(s.modalConfig.tabs)),s.updateConfig(s.modalConfig)}return I.default.createElement("div",{className:"setting-row"},I.default.createElement("label",{htmlFor:e,className:"col description"},s.name),I.default.createElement("div",{className:"col action"},I.default.createElement("button",{title:"Move up",className:"arrow-btn",onClick:()=>r(t,-1)},I.default.createElement("svg",{height:"16",width:"16",viewBox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:String(Spicetify.SVGIcons["chart-up"])}})),I.default.createElement("button",{title:"Move down",className:"arrow-btn",onClick:()=>r(t,1)},I.default.createElement("svg",{height:"16",width:"16",viewBox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:String(Spicetify.SVGIcons["chart-down"])}})),I.default.createElement(me,{name:s.name,storageKey:"tab:"+s.name,clickable:"Extensions"!==s.name,enabled:a,onChange:e=>{console.log({e:e}),s.modalConfig.tabs[t].enabled=e.target.checked,localStorage.setItem(u,JSON.stringify(s.modalConfig.tabs)),s.updateConfig(s.modalConfig)}})))},he=({CONFIG:e,updateAppConfig:t})=>{const[a,s]=E.default.useState(d({},e)),r=e=>{t(d({},e)),s(d({},e))},n=document.querySelector("body > generic-modal button.main-trackCreditsModal-closeBtn"),l=document.querySelector("body > generic-modal > div");return n&&l&&(n.onclick=()=>location.reload(),n.setAttribute("style","cursor: pointer;"),l.onclick=e=>{e.target===l&&location.reload()}),E.default.createElement("div",{id:"marketplace-config-container"},E.default.createElement("h2",null,"Options"),E.default.createElement(O,{name:"Stars count",storageKey:"stars",modalConfig:a,updateConfig:r}),E.default.createElement(O,{name:"Tags",storageKey:"tags",modalConfig:a,updateConfig:r}),E.default.createElement(O,{name:"Hide installed when browsing",storageKey:"hideInstalled",modalConfig:a,updateConfig:r}),E.default.createElement(O,{name:"Shift colors every minute",storageKey:"colorShift",modalConfig:a,updateConfig:r}),E.default.createElement("h2",null,"Tabs"),E.default.createElement("div",{className:"tabs-container"},a.tabs.map(({name:e},t)=>E.default.createElement(de,{key:t,name:e,modalConfig:a,updateConfig:r}))),E.default.createElement("h2",null,"Reset"),E.default.createElement("div",{className:"setting-row"},E.default.createElement("label",{className:"col description"},"Uninstall all extensions and themes, and reset preferences"),E.default.createElement("div",{className:"col action"},E.default.createElement(C,{onClick:Q},"Reset"))))},_=(e,t,a)=>{e=((e,t,a)=>{switch(e){case"ADD_SNIPPET":return{title:"Add Snippet",content:m.default.createElement(ne,null),isLarge:!1};case"RELOAD":return{title:"Reload",content:m.default.createElement(le,null),isLarge:!1};case"SETTINGS":return{title:"Settings",content:m.default.createElement(he,{CONFIG:t,updateAppConfig:a}),isLarge:!0};default:return{title:"",content:m.default.createElement("div",null),isLarge:!1}}})(e,t,a),Spicetify.PopupModal.display(e)};async function fe(e,t,a){var s=window.sessionStorage.getItem(e+"-"+t);const r=window.sessionStorage.getItem("noManifests");if(s)return JSON.parse(s);const n=`https://raw.githubusercontent.com/${e}/${t}/${a}/manifest.json`;if(null!=r&&r.includes(n))return null;s=await fetch(n).then(e=>e.json()).catch(()=>{var s=[n],r="noManifests";s&&null!=s&&s.forEach(e=>{r=r||s.user+"-"+s.repo;var t=window.sessionStorage.getItem(r);const a=t?JSON.parse(t):[];a.push(e),window.sessionStorage.setItem(r,JSON.stringify(a))})});return s&&window.sessionStorage.setItem(e+"-"+t,JSON.stringify(s)),s}var L=r(a("react")),ge=class extends L.default.Component{render(){return L.default.createElement("div",{onClick:this.props.onClick},L.default.createElement("p",{style:{fontSize:100,lineHeight:"65px"}},"»"),L.default.createElement("span",{style:{fontSize:20}},"Load more"))}},x=r(a("react")),ye=()=>x.default.createElement("svg",{width:"100px",height:"100px",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},x.default.createElement("circle",{cx:"50",cy:"50",r:"0",fill:"none",stroke:"currentColor",strokeWidth:"2"},x.default.createElement("animate",{attributeName:"r",repeatCount:"indefinite",dur:"1s",values:"0;40",keyTimes:"0;1",keySplines:"0 0.2 0.8 1",calcMode:"spline",begin:"0s"}),x.default.createElement("animate",{attributeName:"opacity",repeatCount:"indefinite",dur:"1s",values:"1;0",keyTimes:"0;1",keySplines:"0.2 0 0.8 1",calcMode:"spline",begin:"0s"})),x.default.createElement("circle",{cx:"50",cy:"50",r:"0",fill:"none",stroke:"currentColor",strokeWidth:"2"},x.default.createElement("animate",{attributeName:"r",repeatCount:"indefinite",dur:"1s",values:"0;40",keyTimes:"0;1",keySplines:"0 0.2 0.8 1",calcMode:"spline",begin:"-0.5s"}),x.default.createElement("animate",{attributeName:"opacity",repeatCount:"indefinite",dur:"1s",values:"1;0",keyTimes:"0;1",keySplines:"0.2 0 0.8 1",calcMode:"spline",begin:"-0.5s"}))),ve=r(a("react")),be=()=>ve.default.createElement("svg",{role:"img",width:"16",height:"16",viewBox:"0 0 24 24","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg"},ve.default.createElement("path",{d:"M24 13.616v-3.232c-1.651-.587-2.694-.752-3.219-2.019v-.001c-.527-1.271.1-2.134.847-3.707l-2.285-2.285c-1.561.742-2.433 1.375-3.707.847h-.001c-1.269-.526-1.435-1.576-2.019-3.219h-3.232c-.582 1.635-.749 2.692-2.019 3.219h-.001c-1.271.528-2.132-.098-3.707-.847l-2.285 2.285c.745 1.568 1.375 2.434.847 3.707-.527 1.271-1.584 1.438-3.219 2.02v3.232c1.632.58 2.692.749 3.219 2.019.53 1.282-.114 2.166-.847 3.707l2.285 2.286c1.562-.743 2.434-1.375 3.707-.847h.001c1.27.526 1.436 1.579 2.019 3.219h3.232c.582-1.636.75-2.69 2.027-3.222h.001c1.262-.524 2.12.101 3.698.851l2.285-2.286c-.744-1.563-1.375-2.433-.848-3.706.527-1.271 1.588-1.44 3.221-2.021zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z",fill:"currentColor"})),T=r(a("react")),Se=r(t()),Ce=t=>{var e=t.sortBoxOptions.map(e=>({value:e.key,label:e.value})),a=t.sortBoxOptions.find(t.sortBySelectedFn);return T.default.createElement("div",{className:"marketplace-sortBox"},T.default.createElement("div",{className:"marketplace-sortBox-header"},T.default.createElement("div",{className:"marketplace-sortBox-header-title"}),T.default.createElement(Se.default,{placeholder:"Select an option",options:e,value:null==a?void 0:a.key,onChange:e=>{t.onChange(e.value)}})))},R=r(a("react")),ke=r(a("react-dom")),Ee=r(t()),we=class extends R.default.Component{constructor(e){super(e)}render(){return this.props.item.enabled?R.default.createElement("li",{className:"marketplace-tabBar-headerItem","data-tab":this.props.item.value,onClick:e=>{e.preventDefault(),this.props.switchTo(this.props.item.key)}},R.default.createElement("a",{"aria-current":"page",className:"marketplace-tabBar-headerItemLink "+(this.props.item.active?"marketplace-tabBar-active":""),draggable:"false",href:""},R.default.createElement("span",{className:"main-type-mestoBold"},this.props.item.value))):null}},Ne=R.default.memo(function({items:e,switchTo:t}){e=e.map(e=>({value:e.key,label:e.value}));return R.default.createElement("li",{className:"marketplace-tabBar-headerItem"},R.default.createElement(Ee.default,{className:"main-type-mestoBold",options:e,value:"More",placeholder:"More",onChange:e=>{t(e.value)}}))}),Oe=({children:e})=>e?ke.default.createPortal(R.default.createElement("div",{className:"main-topBar-topbarContent"},e),document.querySelector(".main-topBar-topbarContentWrapper")):null,Ie=e=>{const t=document.querySelector(".Root__main-view .os-resize-observer-host");if(!t)return null;const[a,s]=(0,R.useState)(t.clientWidth),r=()=>s(t.clientWidth);return(0,R.useEffect)(()=>{const e=new ResizeObserver(r);return e.observe(t),()=>{e.disconnect()}},[r]),R.default.createElement(Oe,null,R.default.createElement(_e,{windowSize:a,links:e.links,activeLink:e.activeLink,switchCallback:e.switchCallback}))},_e=R.default.memo(function({links:e,activeLink:a,switchCallback:t,windowSize:s=1/0}){const r=R.default.useRef(null),[n,l]=(0,R.useState)([]),[i,o]=(0,R.useState)(0),[c,u]=(0,R.useState)([]),p=e.map(({name:e,enabled:t})=>{return{key:e,value:e,active:e===a,enabled:t}});return(0,R.useEffect)(()=>{r.current&&o(r.current.clientWidth)},[s]),(0,R.useEffect)(()=>{if(r.current){const t=Array.from(r.current.children);var e=t.map(e=>e.clientWidth);l(e)}},[e]),(0,R.useEffect)(()=>{if(r.current)if(n.reduce((e,t)=>e+t,0)<=i)u([]);else{var e=Math.max(...n);const s=[];let a=e;n.forEach((e,t)=>{i>=a+e?a+=e:s.push(t)}),u(s)}},[i,n]),R.default.createElement("nav",{className:"marketplace-tabBar marketplace-tabBar-nav"},R.default.createElement("ul",{className:"marketplace-tabBar-header",ref:r},p.filter((e,t)=>!c.includes(t)).map(e=>R.default.createElement(we,{key:e.key,item:e,switchTo:t})),c.length||0===n.length?R.default.createElement(Ne,{items:c.map(e=>p[e]).filter(e=>e),switchTo:t}):null))}),A=r(a("react")),Le=r(a("react")),xe=()=>Le.default.createElement("svg",{role:"img",width:"16",height:"16",viewBox:"0 0 448 512","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg"},Le.default.createElement("path",{d:"M53.21 467c1.562 24.84 23.02 45 47.9 45h245.8c24.88 0 46.33-20.16 47.9-45L416 128H32L53.21 467zM432 32H320l-11.58-23.16c-2.709-5.42-8.25-8.844-14.31-8.844H153.9c-6.061 0-11.6 3.424-14.31 8.844L128 32H16c-8.836 0-16 7.162-16 16V80c0 8.836 7.164 16 16 16h416c8.838 0 16-7.164 16-16V48C448 39.16 440.8 32 432 32z",fill:"currentColor"})),Te=r(a("react")),Re=()=>Te.default.createElement("svg",{role:"img",width:"16",height:"16",viewBox:"0 0 512 512","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg"},Te.default.createElement("path",{d:"M480 352h-133.5l-45.25 45.25C289.2 409.3 273.1 416 256 416s-33.16-6.656-45.25-18.75L165.5 352H32c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h448c17.67 0 32-14.33 32-32v-96C512 366.3 497.7 352 480 352zM432 456c-13.2 0-24-10.8-24-24c0-13.2 10.8-24 24-24s24 10.8 24 24C456 445.2 445.2 456 432 456zM233.4 374.6C239.6 380.9 247.8 384 256 384s16.38-3.125 22.62-9.375l128-128c12.49-12.5 12.49-32.75 0-45.25c-12.5-12.5-32.76-12.5-45.25 0L288 274.8V32c0-17.67-14.33-32-32-32C238.3 0 224 14.33 224 32v242.8L150.6 201.4c-12.49-12.5-32.75-12.5-45.25 0c-12.49 12.5-12.49 32.75 0 45.25L233.4 374.6z",fill:"currentColor"})),Ae=r(a("react")),Pe=e=>{return Ae.default.createElement("div",{className:"marketplace-card__authors"},e.authors.map((e,t)=>Ae.default.createElement("a",{title:e.name,className:"marketplace-card__author",href:e.url,draggable:"false",dir:"auto",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),key:t},e.name)))},P=r(a("react")),je=a=>{const[e,t]=P.default.useState(!1);var s=e=>e.reduce((e,t)=>(!a.showTags&&"external JS"!==t||e.push(P.default.createElement("li",{className:"marketplace-card__tag",draggable:!1,"data-tag":t},t)),e),[]),r=a.tags.slice(0,4),n=a.tags.slice(4);return P.default.createElement("div",{className:"marketplace-card__tags-container"},P.default.createElement("ul",{className:"marketplace-card__tags"},s(r),n.length&&e?s(n):null),n.length&&!e?P.default.createElement("button",{className:"marketplace-card__tags-more-btn",onClick:e=>{e.stopPropagation(),t(!0)}},"..."):null)},qe=class extends A.default.Component{constructor(e){super(e),this.menuType=Spicetify.ReactComponent.Menu;var t,a="snippet"===e.type?"snippet:":`${e.item.user}/${e.item.repo}/`;let s="";"snippet"===e.type?s=e.item.title.replaceAll(" ","-"):"theme"===e.type?s=(null==(t=e.item.manifest)?void 0:t.usercss)||"":"extension"===e.type&&(s=(null==(t=e.item.manifest)?void 0:t.main)||""),this.localStorageKey="marketplace:installed:"+a+s,Object.assign(this,e),this.tags=e.item.tags||[],e.item.include&&this.tags.push("external JS"),this.state={installed:null!==localStorage.getItem(this.localStorageKey),stars:this.props.item.stars||0,tagsExpanded:!1}}isInstalled(){return null!==localStorage.getItem(this.localStorageKey)}async componentDidMount(){var e;"Installed"===this.props.CONFIG.activeTab&&this.props.CONFIG.visual.stars&&"snippet"!==this.props.type&&(e=`https://api.github.com/repos/${this.props.item.user}/`+this.props.item.repo,e=await fetch(e).then(e=>e.json()),this.state.stars!==e.stargazers_count&&this.setState({stars:e.stargazers_count},()=>{console.log(`Stars updated to: ${this.state.stars}; updating localstorage.`),this.installExtension()}))}buttonClicked(){var e,t;"extension"===this.props.type?(this.isInstalled()?(console.log("Extension already installed, removing"),this.removeExtension()):this.installExtension(),_("RELOAD")):"theme"===this.props.type?(t=(e=localStorage.getItem("marketplace:theme-installed"))?f(e,{}):{},console.log(t),console.log(e),this.isInstalled()?(console.log("Theme already installed, removing"),this.removeTheme(this.localStorageKey)):(this.removeTheme(),this.installTheme()),(null!=(e=this.props.item.manifest)&&e.include||t.include)&&_("RELOAD")):"snippet"===this.props.type?this.isInstalled()?(console.log("Snippet already installed, removing"),this.removeSnippet()):this.installSnippet():console.error("Unknown card type")}installExtension(){var e;console.log("Installing extension "+this.localStorageKey),localStorage.setItem(this.localStorageKey,JSON.stringify({manifest:null==(e=this.props.item)?void 0:e.manifest,type:this.props.type,title:this.props.item.title,subtitle:this.props.item.subtitle,authors:this.props.item.authors,user:this.props.item.user,repo:this.props.item.repo,branch:this.props.item.branch,imageURL:this.props.item.imageURL,extensionURL:this.props.item.extensionURL,readmeURL:this.props.item.readmeURL,stars:this.state.stars}));const t=f(g,[]);-1===t.indexOf(this.localStorageKey)&&(t.push(this.localStorageKey),localStorage.setItem(g,JSON.stringify(t))),console.log("Installed"),this.setState({installed:!0})}removeExtension(){if(localStorage.getItem(this.localStorageKey)){console.log("Removing extension "+this.localStorageKey),localStorage.removeItem(this.localStorageKey);const t=f(g,[]);var e=t.filter(e=>e!==this.localStorageKey);localStorage.setItem(g,JSON.stringify(e)),console.log("Removed"),this.setState({installed:!1})}}async installTheme(){var e;console.log("Installing theme "+this.localStorageKey);let t={};if(this.props.item.schemesURL){const r=await fetch(this.props.item.schemesURL);var a=await r.text();t=(e=>{const a={section:/^\s*\[\s*([^\]]*)\s*\]\s*$/,param:/^\s*([^=]+?)\s*=\s*(.*?)\s*$/,comment:/^\s*;.*$/},s={},t=e.split(/[\r\n]+/);let r=null;return t.forEach(function(e){var t;a.comment.test(e)||(a.param.test(e)?(t=e.match(a.param),r?s[r][t[1]]=t[2]:s[t[1]]=t[2]):a.section.test(e)?(t=e.match(a.section),s[t[1]]={},r=t[1]):0==e.length&&r&&(r=null))}),s})(a)}a=Object.keys(t)[0],console.log(t,a),a=a||null;localStorage.setItem(this.localStorageKey,JSON.stringify({manifest:null==(e=this.props.item)?void 0:e.manifest,type:this.props.type,title:this.props.item.title,subtitle:this.props.item.subtitle,authors:this.props.item.authors,user:this.props.item.user,repo:this.props.item.repo,branch:this.props.item.branch,imageURL:this.props.item.imageURL,extensionURL:this.props.item.extensionURL,readmeURL:this.props.item.readmeURL,stars:this.state.stars,tags:this.tags,cssURL:this.props.item.cssURL,schemesURL:this.props.item.schemesURL,include:this.props.item.include,schemes:t,activeScheme:a}));const s=f(v,[]);-1===s.indexOf(this.localStorageKey)&&(s.push(this.localStorageKey),localStorage.setItem(v,JSON.stringify(s)),localStorage.setItem(p,this.localStorageKey)),console.log("Installed"),this.props.item.include||(this.fetchAndInjectUserCSS(this.localStorageKey),this.props.updateActiveTheme(this.localStorageKey),this.props.updateColourSchemes(t,a)),this.setState({installed:!0})}removeTheme(t){var e=(t=t||localStorage.getItem(p))&&localStorage.getItem(t);if(t&&e){console.log("Removing theme "+t),localStorage.removeItem(t),localStorage.removeItem(p);const a=f(v,[]);e=a.filter(e=>e!==t);localStorage.setItem(v,JSON.stringify(e)),console.log("Removed"),this.fetchAndInjectUserCSS(null),this.props.updateActiveTheme(null),this.props.updateColourSchemes(null,null),this.setState({installed:!1})}}installSnippet(){console.log("Installing snippet "+this.localStorageKey),localStorage.setItem(this.localStorageKey,JSON.stringify({code:this.props.item.code,title:this.props.item.title,description:this.props.item.description}));const e=f(y,[]);-1===e.indexOf(this.localStorageKey)&&(e.push(this.localStorageKey),localStorage.setItem(y,JSON.stringify(e)));var t=e.map(e=>f(e));c(t),this.setState({installed:!0})}removeSnippet(){localStorage.removeItem(this.localStorageKey);const e=f(y,[]),t=e.filter(e=>e!==this.localStorageKey);localStorage.setItem(y,JSON.stringify(t));var a=t.map(e=>f(e));c(a),this.setState({installed:!1})}async fetchAndInjectUserCSS(e){try{var t=e?await(async e=>{if(!e.cssURL)throw new Error("No CSS URL provided");const t=-1<e.cssURL.indexOf("raw.githubusercontent.com")?`https://cdn.jsdelivr.net/gh/${e.user}/${e.repo}@${e.branch}/`+e.manifest.usercss:e.cssURL;var a,s=t.replace("/user.css","/assets/");console.log("Parsing CSS: ",t);let r=await fetch(t+"?time="+Date.now()).then(e=>e.text());for(const n of r.matchAll(new RegExp(`url\\(['|"](?<path>.+?)['|"]\\)`,"gm"))||[]){const l=null==(a=null==n?void 0:n.groups)?void 0:a.path;!l||l.startsWith("http")||l.startsWith("data")||(a=s+l.replace(/\.\//g,""),r=r.replace(l,a))}return r})(this.props.item):void 0;try{const a=document.querySelector("link[href='user.css']"),s=(a&&a.remove(),document.querySelector("style.marketplaceCSS.marketplaceUserCSS"));if(s&&s.remove(),t){const r=document.createElement("style");r.classList.add("marketplaceCSS"),r.classList.add("marketplaceUserCSS"),r.innerHTML=t,document.head.appendChild(r)}else{const n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href","user.css"),n.classList.add("userCSS"),document.head.appendChild(n)}}catch(e){console.warn(e)}}catch(e){console.warn(e)}}openReadme(){var e;null!=(e=this.props.item)&&e.manifest&&null!=(e=null==(e=this.props.item)?void 0:e.manifest)&&e.readme?Spicetify.Platform.History.push({pathname:te+"/readme",state:{data:{title:this.props.item.title,user:this.props.item.user,repo:this.props.item.repo,branch:this.props.item.branch,readmeURL:this.props.item.readmeURL}}}):Spicetify.showNotification("No page was found")}render(){var e,t=this.isInstalled();if("Installed"===this.props.CONFIG.activeTab&&!t)return console.log("Card item not installed"),null;const a=["main-card-card","marketplace-card--"+this.props.type],s=(t&&a.push("marketplace-card--installed"),[]);return"snippet"!==this.props.type&&this.props.visual.stars&&s.push("★ "+this.state.stars),A.default.createElement("div",{className:a.join(" "),onClick:()=>this.openReadme()},A.default.createElement("div",{className:"main-card-draggable",draggable:"true"},A.default.createElement("div",{className:"main-card-imageContainer"},A.default.createElement("div",{className:"main-cardImage-imageWrapper"},A.default.createElement("div",null,A.default.createElement("img",{alt:"","aria-hidden":"false",draggable:"false",loading:"lazy",src:this.props.item.imageURL,className:"main-image-image main-cardImage-image",onError:e=>{e.currentTarget.setAttribute("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII"),null!=(e=e.currentTarget.closest(".main-cardImage-imageWrapper"))&&e.classList.add("main-cardImage-imageWrapper--error")}})))),A.default.createElement("div",{className:"main-card-cardMetadata"},A.default.createElement("a",{draggable:"false",title:"snippet"===this.props.type?this.props.item.title:null==(e=this.props.item.manifest)?void 0:e.name,className:"main-cardHeader-link",dir:"auto",href:"snippet"!==this.props.type?`https://github.com/${this.props.item.user}/`+this.props.item.repo:"https://github.com/spicetify/spicetify-marketplace/blob/main/resources/snippets.json",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation()},A.default.createElement("div",{className:"main-cardHeader-text main-type-balladBold"},this.props.item.title)),A.default.createElement("div",{className:"main-cardSubHeader-root main-type-mestoBold marketplace-cardSubHeader"},this.props.item.authors&&A.default.createElement(Pe,{authors:this.props.item.authors}),A.default.createElement("span",null,s.join(" ‒ "))),A.default.createElement("p",{className:"marketplace-card-desc"},"snippet"===this.props.type?this.props.item.description:null==(e=this.props.item.manifest)?void 0:e.description),this.tags.length?A.default.createElement("div",{className:"marketplace-card__bottom-meta main-type-mestoBold"},A.default.createElement(je,{tags:this.tags,showTags:this.props.CONFIG.visual.tags})):null,t&&A.default.createElement("div",{className:"marketplace-card__bottom-meta main-type-mestoBold"},"✓ Installed"),A.default.createElement("div",{className:"main-card-PlayButtonContainer"},A.default.createElement(C,{classes:["marketplace-installButton"],type:"circle",label:t?"Remove":"Save",onClick:e=>{e.stopPropagation(),this.buttonClicked()}},t?A.default.createElement(xe,null):A.default.createElement(Re,null))))))}},Me=class extends o.default.Component{constructor(e){super(e),this.endOfList=!1,this.lastScroll=0,this.requestQueue=[],this.requestPage=0,this.cardList=[],Object.assign(this,e),this.updateAppConfig=e.updateAppConfig.bind(this),this.sortConfig={by:f(X,"top")},this.state={searchValue:"",cards:[],tabs:e.CONFIG.tabs,rest:!0,endOfList:!1,schemes:e.CONFIG.theme.schemes,activeScheme:e.CONFIG.theme.activeScheme,activeThemeKey:e.CONFIG.theme.activeThemeKey}}getInstalledTheme(){var e=localStorage.getItem(p);if(!e)return null;e=localStorage.getItem(e);return e?JSON.parse(e):null}newRequest(e,t){this.cardList=[];var a=[];this.requestQueue.unshift(a),this.loadAmount(a,e,t)}appendCard(e,t){e=o.default.createElement(qe,{item:e,key:this.props.CONFIG.activeTab+":"+e.title,CONFIG:this.CONFIG,visual:this.props.CONFIG.visual,type:t,activeThemeKey:this.state.activeThemeKey,updateColourSchemes:this.updateColourSchemes.bind(this),updateActiveTheme:this.setActiveTheme.bind(this)});this.cardList.push(e),this.setState({cards:this.cardList})}updateSort(e){e&&(this.sortConfig.by=e,localStorage.setItem(X,e)),this.requestPage=0,this.cardList=[],this.setState({cards:[],rest:!1,endOfList:!1}),this.endOfList=!1,this.newRequest(b)}updateTabs(){this.setState({tabs:[...this.props.CONFIG.tabs]})}updatePostsVisual(){this.cardList=this.cardList.map(e=>o.default.createElement(qe,h(d({},e.props),{CONFIG:this.CONFIG}))),this.setState({cards:[...this.cardList]})}switchTo(e){this.CONFIG.activeTab=e,localStorage.setItem(Z,e),this.cardList=[],this.requestPage=0,this.setState({cards:[],rest:!1,endOfList:!1}),this.endOfList=!1,this.newRequest(b)}async loadPage(t,e){switch(this.CONFIG.activeTab){case"Extensions":var a=await async function(e=1,t=[],a){let s=a?`https://api.github.com/search/repositories?q=${encodeURIComponent(a+"+topic:spicetify-extensions")}&per_page=100`:`https://api.github.com/search/repositories?q=${encodeURIComponent("topic:spicetify-extensions")}&per_page=100`;e&&(s+="&page="+e);const r=await fetch(s).then(e=>e.json()).catch(()=>[]);return r.items||Spicetify.showNotification("Too Many Requests, Cool Down."),h(d({},r),{page_count:r.items.length,items:r.items.filter(e=>!t.includes(e.html_url))})}(this.requestPage,this.BLACKLIST,e);for(const l of a.items){const i=await async function(t,s,r,n=!1){try{let e;var a=t.match(new RegExp("https:\\/\\/api\\.github\\.com\\/repos\\/(?<user>.+)\\/(?<repo>.+)\\/contents"));if(!a||!a.groups)return null;const{user:l,repo:i}=a.groups;return e=await fe(l,i,s),(e=Array.isArray(e)?e:[e]).reduce((e,t)=>{var a=t.branch||s,a={manifest:t,title:t.name,subtitle:t.description,authors:z(t.authors,l),user:l,repo:i,branch:a,imageURL:t.preview&&t.preview.startsWith("http")?t.preview:`https://raw.githubusercontent.com/${l}/${i}/${a}/`+t.preview,extensionURL:t.main.startsWith("http")?t.main:`https://raw.githubusercontent.com/${l}/${i}/${a}/`+t.main,readmeURL:t.readme&&t.readme.startsWith("http")?t.readme:`https://raw.githubusercontent.com/${l}/${i}/${a}/`+t.readme,stars:r,tags:t.tags};return t&&t.name&&t.description&&t.main&&(n&&localStorage.getItem(`marketplace:installed:${l}/${i}/`+t.main)||e.push(a)),e},[])}catch(e){return null}}(l.contents_url,l.default_branch,l.stargazers_count,this.CONFIG.visual.hideInstalled);if(1<this.requestQueue.length&&t!==this.requestQueue[0])return-1;i&&i.length&&i.forEach(e=>this.appendCard(e,"extension"))}var s=-1<this.requestPage&&this.requestPage?this.requestPage:1,r=b*(s-1)+a.page_count,n=a.total_count-r;if(console.log(`Parsed ${r}/${a.total_count} extensions`),0<n)return s+1;console.log("No more extension results");break;case"Installed":{const o={theme:f(v,[]),extension:f(g,[]),snippet:f(y,[])};for(const c in o)o[c].length&&o[c].forEach(async e=>{e=f(e);if(1<this.requestQueue.length&&t!==this.requestQueue[0])return-1;this.appendCard(e,c)});break}case"Themes":r=await async function(e=1,t=[],a){let s=a?`https://api.github.com/search/repositories?q=${encodeURIComponent(a+"+topic:spicetify-extensions")}&per_page=100`:`https://api.github.com/search/repositories?q=${encodeURIComponent("topic:spicetify-themes")}&per_page=100`;e&&(s+="&page="+e);const r=await fetch(s).then(e=>e.json()).catch(()=>[]);return r.items||Spicetify.showNotification("Too Many Requests, Cool Down."),h(d({},r),{page_count:r.items.length,items:r.items.filter(e=>!t.includes(e.html_url))})}(this.requestPage,this.BLACKLIST,e);for(const u of r.items){const p=await async function(t,s,r){try{let e;var a=t.match(new RegExp("https:\\/\\/api\\.github\\.com\\/repos\\/(?<user>.+)\\/(?<repo>.+)\\/contents"));if(!a||!a.groups)return null;const{user:n,repo:l}=a.groups;return e=await fe(n,l,s),(e=Array.isArray(e)?e:[e]).reduce((e,t)=>{var a=t.branch||s,a={manifest:t,title:t.name,subtitle:t.description,authors:z(t.authors,n),user:n,repo:l,branch:a,imageURL:t.preview&&t.preview.startsWith("http")?t.preview:`https://raw.githubusercontent.com/${n}/${l}/${a}/`+t.preview,readmeURL:t.readme&&t.readme.startsWith("http")?t.readme:`https://raw.githubusercontent.com/${n}/${l}/${a}/`+t.readme,stars:r,tags:t.tags,cssURL:t.usercss.startsWith("http")?t.usercss:`https://raw.githubusercontent.com/${n}/${l}/${a}/`+t.usercss,schemesURL:t.schemes?t.schemes.startsWith("http")?t.schemes:`https://raw.githubusercontent.com/${n}/${l}/${a}/`+t.schemes:null,include:t.include};return null!=t&&t.name&&null!=t&&t.usercss&&null!=t&&t.description&&e.push(a),e},[])}catch(e){return null}}(u.contents_url,u.default_branch,u.stargazers_count);if(1<this.requestQueue.length&&t!==this.requestQueue[0])return-1;p&&p.length&&p.forEach(e=>this.appendCard(e,"theme"))}a=-1<this.requestPage&&this.requestPage?this.requestPage:1,n=b*(a-1)+r.page_count,s=r.total_count-n;if(console.log(`Parsed ${n}/${r.total_count} themes`),0<s)return a+1;console.log("No more theme results");break;case"Snippets":{const m=await fetch("https://raw.githubusercontent.com/spicetify/spicetify-marketplace/main/resources/snippets.json").then(e=>e.json()).catch(()=>({}));if(1<this.requestQueue.length&&t!==this.requestQueue[0])return-1;m&&m.length&&m.forEach(e=>this.appendCard(e,"snippet"))}}return this.setState({rest:!0,endOfList:!0}),this.endOfList=!0,0}async loadAmount(t,e=b,a){for(this.setState({rest:!1}),e+=this.cardList.length,this.requestPage=await this.loadPage(t,a);this.requestPage&&-1!==this.requestPage&&this.cardList.length<e&&!this.state.endOfList;)this.requestPage=await this.loadPage(t,a);-1===this.requestPage?this.requestQueue=this.requestQueue.filter(e=>e!==t):(this.requestQueue.shift(),this.setState({rest:!0}))}loadMore(){this.state.rest&&!this.endOfList&&this.loadAmount(this.requestQueue[0],b)}updateColourSchemes(e,t){console.log("updateColourSchemes",e,t),this.CONFIG.theme.schemes=e,this.CONFIG.theme.activeScheme=t,e&&t&&e[t]?Y(null==(a=this.CONFIG.theme.schemes)?void 0:a[t]):Y(null);var a=f(p);const s=f(a);s?(s.activeScheme=t,console.log(s),localStorage.setItem(a,JSON.stringify(s))):console.log("No installed theme data"),this.setState({schemes:e,activeScheme:t})}async componentDidMount(){this.gridUpdateTabs=this.updateTabs.bind(this),this.gridUpdatePostsVisual=this.updatePostsVisual.bind(this);const e=document.querySelector(".os-viewport");this.checkScroll=this.isScrolledBottom.bind(this),e&&(e.addEventListener("scroll",this.checkScroll),this.cardList.length)?0<this.lastScroll&&e.scrollTo(0,this.lastScroll):(this.BLACKLIST=await(await fetch("https://raw.githubusercontent.com/spicetify/spicetify-marketplace/main/resources/blacklist.json").then(e=>e.json()).catch(()=>({}))).repos,this.newRequest(b))}componentWillUnmount(){this.gridUpdateTabs=this.gridUpdatePostsVisual=null;const e=document.querySelector(".os-viewport");e&&(this.lastScroll=e.scrollTop,e.removeEventListener("scroll",this.checkScroll))}isScrolledBottom(e){e=e.target;e.scrollTop+e.clientHeight>=e.scrollHeight&&this.loadMore()}setActiveTheme(e){this.CONFIG.theme.activeThemeKey=e,this.setState({activeThemeKey:e})}getActiveScheme(){return this.state.activeScheme}render(){return o.default.createElement("section",{className:"contentSpacing"},o.default.createElement("div",{className:"marketplace-header"},o.default.createElement("h1",null,this.props.title),o.default.createElement("div",{className:"marketplace-header__right"},this.state.activeScheme?o.default.createElement(Ce,{onChange:e=>this.updateColourSchemes(this.state.schemes,e),sortBoxOptions:(e=this.state.schemes)?Object.keys(e).map(e=>({key:e,value:e})):[],sortBySelectedFn:e=>e.key===this.getActiveScheme()}):null,o.default.createElement("button",{type:"button",title:"Settings",className:"marketplace-settings-button",id:"marketplace-settings-button",onClick:()=>_("SETTINGS",this.CONFIG,this.updateAppConfig)},o.default.createElement(be,null)))),o.default.createElement("div",{className:"searchbar--bar__wrapper"},o.default.createElement("input",{className:"searchbar-bar",type:"text",placeholder:`Search ${this.CONFIG.activeTab}...`,value:this.state.searchValue,onChange:e=>{this.setState({searchValue:e.target.value})},onKeyDown:e=>{"Enter"===e.key?(this.setState({endOfList:!1}),this.newRequest(b,this.state.searchValue.trim().toLowerCase()),this.searchRequested=!0):"Backspace"!==e.key&&"Delete"!==e.key||!this.searchRequested||""!==this.state.searchValue.trim()||(this.setState({endOfList:!1}),this.newRequest(b,this.state.searchValue.trim().toLowerCase()),this.searchRequested=!1)}})),[{handle:"extension",name:"Extensions"},{handle:"theme",name:"Themes"},{handle:"snippet",name:"Snippets"}].map(t=>{var e=this.cardList.filter(e=>e.props.type===t.handle).filter(e=>{const t=this.state["searchValue"],{title:a,user:s}=e.props.item;if(""===t.trim()||a.toLowerCase().includes(t.trim().toLowerCase())||null!=s&&s.toLowerCase().includes(t.trim().toLowerCase()))return e}).map(e=>{return o.default.cloneElement(e,{activeThemeKey:this.state.activeThemeKey})});return e.length?o.default.createElement(o.default.Fragment,null,o.default.createElement("h2",{className:"marketplace-card-type-heading"},t.name),o.default.createElement("div",{className:"marketplace-grid main-gridContainer-gridContainer main-gridContainer-fixedWidth","data-tab":this.CONFIG.activeTab,"data-card-type":t.name},e)):null}),"Snippets"===this.CONFIG.activeTab?o.default.createElement(C,{classes:["marketplace-add-snippet-btn"],onClick:()=>_("ADD_SNIPPET")},"+Add CSS"):null,o.default.createElement("footer",{className:"marketplace-footer"},!this.state.endOfList&&(this.state.rest?o.default.createElement(ge,{onClick:this.loadMore.bind(this)}):o.default.createElement(ye,null))),o.default.createElement(Ie,{switchCallback:this.switchTo.bind(this),links:this.CONFIG.tabs,activeLink:this.CONFIG.activeTab}));var e}},j=r(a("react")),$e=class extends j.default.Component{constructor(){super(...arguments),this.state={html:"<p>Loading...</p>"}}async getReadmeHTML(){try{const a=await fetch(this.props.data.readmeURL);if(!a.ok)throw Spicetify.showNotification(`Error loading README (HTTP ${a.status})`);var e={text:await a.text(),context:this.props.data.user+"/"+this.props.data.repo,mode:"gfm"};const s=await fetch("https://api.github.com/markdown",{method:"POST",body:JSON.stringify(e)});if(!s.ok)throw Spicetify.showNotification(`Error parsing README (HTTP ${s.status})`);var t=await s.text();return null==t&&Spicetify.Platform.History.goBack(),t}catch(e){return Spicetify.Platform.History.goBack(),null}}componentDidMount(){this.getReadmeHTML().then(e=>{null!=e&&this.setState({html:e})})}componentDidUpdate(){document.querySelectorAll("#marketplace-readme img").forEach(e=>{e.addEventListener("error",e=>{const t=e.target;e=t.getAttribute("src"),e=`https://raw.githubusercontent.com/${this.props.data.user}/${this.props.data.repo}/${this.props.data.branch}/`+e;t.setAttribute("src",e)},{once:!0})})}render(){return j.default.createElement("section",{className:"contentSpacing"},j.default.createElement("div",{className:"marketplace-header"},j.default.createElement("h1",null,this.props.title)),j.default.createElement("div",{id:"marketplace-readme",className:"marketplace-readme__container",dangerouslySetInnerHTML:{__html:this.state.html}}))}},Ue=class extends i.default.Component{constructor(e){super(e),this.state={count:0,CONFIG:{}},this.updateConfig=e=>{this.CONFIG=d({},e),console.log("updated config",this.CONFIG),this.setState({CONFIG:d({},e)})};e=f(u,null);let t=[];try{if(t=JSON.parse(e),!Array.isArray(t))throw new Error("Could not parse marketplace tabs key");if(0===t.length)throw new Error("Empty marketplace tabs key");if(0<t.filter(e=>!e).length)throw new Error("Falsey marketplace tabs key")}catch(e){t=ee,localStorage.setItem(u,JSON.stringify(t))}let a={},s=null;try{var r=f(p,null);if(r){var n=f(r,null);if(!n)throw new Error("No installed theme data");a=n.schemes,s=n.activeScheme}else console.log("No theme set as installed")}catch(e){console.error(e)}this.CONFIG={visual:{stars:JSON.parse(f("marketplace:stars",!0)),tags:JSON.parse(f("marketplace:tags",!0)),hideInstalled:JSON.parse(f("marketplace:hideInstalled",!1)),colorShift:JSON.parse(f("marketplace:colorShift",!1)),type:JSON.parse(f("marketplace:type",!1)),followers:JSON.parse(f("marketplace:followers",!1))},tabs:t,activeTab:f(Z,t[0]),theme:{activeThemeKey:f(p,null),schemes:a,activeScheme:s}},this.CONFIG.activeTab&&this.CONFIG.tabs.filter(e=>e.name===this.CONFIG.activeTab).length||(this.CONFIG.activeTab=this.CONFIG.tabs[0].name)}render(){var e=Spicetify.Platform.History["location"];return e.pathname===te+"/readme"?i.default.createElement($e,{title:"Spicetify Marketplace - Readme",data:e.state.data}):i.default.createElement(Me,{title:"Spicetify Marketplace",CONFIG:this.CONFIG,updateAppConfig:this.updateConfig})}},Fe=r(a("react"));return t=H,B(n({},"__esModule",{value:!0}),t)})();const render=()=>marketplace.default();